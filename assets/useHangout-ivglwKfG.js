import{c as L,s as le,H as ce,B as y,S as Y,I as K,G as X,y as Z,z as _,E as ee,C as P,e as k,d as p,L as de,t as q}from"./App-DVLCLnW2.js";import{b as c,j as e}from"./theme-provider-Cr7NOLPU.js";import{B as te,C as ae}from"./scroll-area-1ssVstT4.js";import{f as pe,S as me,G as ue,H as he,E as xe,l as ge,P as fe,j as je,k as ve,i as G,d as be,h as ye}from"./id-D800pGYJ.js";import{I as R}from"./input-CvXsPVmF.js";import{L as A}from"./label-BiwBe9Ab.js";import{T as Ne}from"./textarea-Bt_1WTGj.js";import{t as o}from"./index-oswWPzvh.js";import{S as we}from"./square-pen-DWy1j8DG.js";import{U as De}from"./users-ChDfDd9T.js";import{T as V}from"./trash-2-2mc2yYUg.js";/**
 * @license lucide-react v0.532.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ce=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],Pe=L("copy",Ce);/**
 * @license lucide-react v0.532.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ke=[["path",{d:"M11.562 3.266a.5.5 0 0 1 .876 0L15.39 8.87a1 1 0 0 0 1.516.294L21.183 5.5a.5.5 0 0 1 .798.519l-2.834 10.246a1 1 0 0 1-.956.734H5.81a1 1 0 0 1-.957-.734L2.02 6.02a.5.5 0 0 1 .798-.519l4.276 3.664a1 1 0 0 0 1.516-.294z",key:"1vdc57"}],["path",{d:"M5 21h14",key:"11awu3"}]],Ue=L("crown",ke);/**
 * @license lucide-react v0.532.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Se=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],Me=L("map-pin",Se);/**
 * @license lucide-react v0.532.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ae=[["path",{d:"M12 2v13",key:"1km8f5"}],["path",{d:"m16 6-4-4-4 4",key:"13yo43"}],["path",{d:"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8",key:"1b2hhj"}]],Ye=L("share",Ae),Ke=[{icon:le,label:"Food & Drink",value:"food"},{icon:pe,label:"Transport",value:"transport"},{icon:me,label:"Shopping",value:"shopping"},{icon:ce,label:"Home",value:"home"},{icon:ue,label:"Entertainment",value:"entertainment"},{icon:he,label:"Health",value:"health"},{icon:xe,label:"Others",value:"others"}],He=[{value:"treat",label:"Treat",description:"Host pays everything"},{value:"equal",label:"Equal Split",description:"Split evenly among all participants"},{value:"manual",label:"Manual",description:"Custom amounts for each person"}],W=t=>{if(!t)return!1;const d=new Date(t);return d instanceof Date&&!isNaN(d.getTime())},Q=t=>{if(!t)return new Date;if(t instanceof Date)return W(t)?t:new Date;if(typeof t=="string"||typeof t=="number"){const d=new Date(t);return W(d)?d:new Date}return new Date},se=(t,d,h)=>{const S=Q(t);try{return ye(S,d,h)}catch(x){return console.warn("Date formatting error:",x),"Invalid Date"}};function Xe({hangout:t,formatCurrency:d,onUpdate:h}){var E,T,F,O,$;const[S,x]=c.useState(!1),[H,f]=c.useState(!1),[w,j]=c.useState(!1),[v,m]=c.useState(!1),[r,g]=c.useState({title:t.title||"",description:t.description||"",location:t.location||"",splitMethod:t.splitMethod||"equal",maxParticipants:((E=t.maxParticipants)==null?void 0:E.toString())||""}),[M,D]=c.useState(Q(t.date)),I=((T=t.hangoutExpenses)==null?void 0:T.reduce((n,b)=>n+((b==null?void 0:b.amount)||0),0))||0,i=async()=>{if(!r.title.trim()){o.error("Please enter hangout title");return}j(!0);try{await p.transact([p.tx.hangouts[t.id].update({title:r.title.trim(),description:r.description.trim()||void 0,location:r.location.trim()||void 0,date:M,splitMethod:r.splitMethod,maxParticipants:r.maxParticipants?parseInt(r.maxParticipants):void 0,updatedAt:new Date})]),o.success("Hangout updated successfully"),x(!1),h==null||h()}catch(n){console.error("Update hangout error:",n),o.error("Failed to update hangout")}finally{j(!1)}},z=async()=>{j(!0);try{await p.transact([p.tx.hangouts[t.id].delete()]),o.success("Hangout deleted successfully"),f(!1),x(!1),h==null||h()}catch(n){console.error("Delete hangout error:",n),o.error("Failed to delete hangout")}finally{j(!1)}},u=async()=>{try{await navigator.clipboard.writeText(t.joinCode),o.success("Join code copied to clipboard")}catch{o.error("Failed to copy join code")}},B=()=>{var n;g({title:t.title||"",description:t.description||"",location:t.location||"",splitMethod:t.splitMethod||"equal",maxParticipants:((n=t.maxParticipants)==null?void 0:n.toString())||""}),D(Q(t.date))};return e.jsxs(e.Fragment,{children:[e.jsx(y,{size:"icon",variant:"ghost",onClick:()=>{B(),x(!0)},className:"hover:bg-orange-100 dark:hover:bg-orange-900/20",children:e.jsx(Y,{className:"h-4 w-4"})}),e.jsx(K,{open:S,onOpenChange:x,children:e.jsxs(X,{className:"max-h-[90vh] overflow-y-auto",children:[e.jsxs(Z,{children:[e.jsxs(_,{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-full bg-orange-100 dark:bg-orange-900/30",children:e.jsx(Y,{className:"h-5 w-5 text-orange-600"})}),"Hangout Settings"]}),e.jsx(ee,{children:"Manage your hangout details, split method, and participants"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(P,{className:"border-orange-200 bg-orange-50 dark:border-orange-800 dark:bg-orange-900/20",children:e.jsxs(k,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:d(I)}),e.jsx("p",{className:"text-sm text-orange-700 dark:text-orange-300",children:"Total Expenses"})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(P,{className:"border-blue-200 bg-blue-50 dark:border-blue-800 dark:bg-blue-900/20",children:e.jsxs(k,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:((F=t.hangoutParticipants)==null?void 0:F.length)||0}),e.jsx("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:"Participants"})]})}),e.jsx(P,{className:"border-green-200 bg-green-50 dark:border-green-800 dark:bg-green-900/20",children:e.jsxs(k,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:((O=t.hangoutExpenses)==null?void 0:O.length)||0}),e.jsx("p",{className:"text-sm text-green-700 dark:text-green-300",children:"Transactions"})]})})]}),t.joinCode&&e.jsx(P,{className:"border-purple-200 bg-purple-50 dark:border-purple-800 dark:bg-purple-900/20",children:e.jsx(k,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-purple-700 dark:text-purple-300",children:"Join Code"}),e.jsx("p",{className:"text-sm text-purple-600 dark:text-purple-400",children:"Share this code with friends"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(te,{variant:"outline",className:"px-3 py-1 font-mono text-lg",children:t.joinCode}),e.jsx(y,{size:"sm",variant:"outline",onClick:u,children:e.jsx(Pe,{className:"h-4 w-4"})})]})]})})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"flex items-center gap-2 text-lg font-semibold",children:[e.jsx(we,{className:"h-5 w-5"}),"Edit Details"]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{children:[e.jsx(A,{htmlFor:"title",children:"Hangout Title *"}),e.jsx(R,{id:"title",placeholder:"Weekend trip, Birthday party, etc.",value:r.title,onChange:n=>g({...r,title:n.target.value}),className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(A,{htmlFor:"description",children:"Description"}),e.jsx(Ne,{id:"description",placeholder:"Tell your friends what this hangout is about...",value:r.description,onChange:n=>g({...r,description:n.target.value}),className:"mt-2 resize-none",rows:3})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(A,{children:"Date"}),e.jsxs(ge,{open:v,onOpenChange:m,children:[e.jsx(fe,{asChild:!0,children:e.jsxs(y,{variant:"outline",className:"mt-2 w-full justify-start",children:[e.jsx(ae,{className:"mr-2 h-4 w-4"}),se(M,"PPP",{locale:G})]})}),e.jsx(je,{className:"w-auto p-0",align:"start",children:e.jsx(ve,{mode:"single",selected:M,onSelect:n=>{n&&W(n)&&(D(n),m(!1))},locale:G})})]})]}),e.jsxs("div",{children:[e.jsx(A,{htmlFor:"location",children:"Location"}),e.jsx(R,{id:"location",placeholder:"Restaurant, Park, Mall, etc.",value:r.location,onChange:n=>g({...r,location:n.target.value}),className:"mt-2"})]})]}),e.jsxs("div",{children:[e.jsx(A,{className:"mb-2 block",children:"Split Method"}),e.jsx("div",{className:"mt-2 grid grid-cols-1 gap-4 sm:grid-cols-2",children:He.map(n=>{const b=r.splitMethod===n.value;return e.jsx(P,{onClick:()=>g({...r,splitMethod:n.value}),className:`cursor-pointer transition-all hover:shadow-md ${b?"border-orange-500 ring-2 ring-orange-200":"hover:border-orange-200"}`,children:e.jsxs(k,{className:"space-y-1 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"font-semibold",children:n.label}),b&&e.jsx("div",{className:"h-2 w-2 rounded-full bg-orange-500"})]}),e.jsx("p",{className:"text-muted-foreground text-sm",children:n.description})]})},n.value)})})]}),e.jsxs("div",{children:[e.jsx(A,{htmlFor:"maxParticipants",children:"Maximum Participants (Optional)"}),e.jsx(R,{id:"maxParticipants",type:"number",placeholder:"Leave empty for unlimited",value:r.maxParticipants,onChange:n=>g({...r,maxParticipants:n.target.value}),className:"mt-2",min:"1",max:"50"})]}),e.jsx(P,{className:"border-2 border-dashed border-orange-200 bg-orange-50 dark:border-orange-800 dark:bg-orange-900/20",children:e.jsx(k,{className:"p-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"font-semibold text-orange-700 dark:text-orange-300",children:"Preview"}),e.jsx(te,{className:"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-100",children:r.splitMethod})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold",children:r.title}),r.description&&e.jsx("p",{className:"text-muted-foreground text-sm",children:r.description})]}),e.jsxs("div",{className:"text-muted-foreground flex gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ae,{className:"h-4 w-4"}),se(M,"dd MMM yyyy",{locale:G})]}),r.location&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Me,{className:"h-4 w-4"}),r.location]}),r.maxParticipants&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(De,{className:"h-4 w-4"}),"Max: ",r.maxParticipants]})]})]})})})]}),e.jsxs("div",{className:"flex items-center justify-between border-t pt-4",children:[e.jsxs(y,{variant:"destructive",size:"sm",onClick:()=>f(!0),className:"flex items-center gap-2",children:[e.jsx(V,{className:"h-4 w-4"}),"Delete Hangout"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(y,{variant:"outline",onClick:()=>x(!1),children:"Cancel"}),e.jsxs(y,{onClick:i,disabled:w||!r.title.trim(),className:"flex items-center gap-2",children:[w?e.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-white border-t-transparent"}):e.jsx(be,{className:"h-4 w-4"}),"Save Changes"]})]})]})]})]})}),e.jsx(K,{open:H,onOpenChange:f,children:e.jsxs(X,{className:"max-w-md",children:[e.jsxs(Z,{children:[e.jsxs(_,{className:"flex items-center gap-2 text-red-600",children:[e.jsx(V,{className:"h-5 w-5"}),"Delete Hangout?"]}),e.jsx(ee,{children:"This action cannot be undone. This will permanently delete the hangout and all associated expenses."})]}),e.jsx(P,{className:"border-red-200 bg-red-50 dark:border-red-800 dark:bg-red-900/20",children:e.jsx(k,{className:"p-4",children:e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Hangout:"}),e.jsx("span",{className:"font-semibold",children:t.title})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Total Expenses:"}),e.jsx("span",{className:"font-semibold text-red-600",children:d(I)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Participants:"}),e.jsx("span",{className:"font-semibold",children:(($=t.hangoutParticipants)==null?void 0:$.length)||0})]})]})})}),e.jsxs("div",{className:"flex items-center justify-end gap-2 pt-4",children:[e.jsx(y,{variant:"outline",onClick:()=>f(!1),children:"Cancel"}),e.jsxs(y,{variant:"destructive",onClick:z,disabled:w,className:"flex items-center gap-2",children:[w?e.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-white border-t-transparent"}):e.jsx(V,{className:"h-4 w-4"}),"Delete Permanently"]})]})]})})]})}const Ie=()=>Math.random().toString(36).substring(2,8).toUpperCase(),Ee=t=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(t),re=t=>{if(!t)return!1;const d=new Date(t);return d instanceof Date&&!isNaN(d.getTime())},N=t=>{if(!t)return new Date;if(t instanceof Date)return re(t)?t:new Date;if(typeof t=="string"||typeof t=="number"){const d=new Date(t);return re(d)?d:new Date}return new Date};function Ze(){const[t,d]=c.useState("mine"),[h,S]=c.useState(!1),[x,H]=c.useState(!1),[f,w]=c.useState(""),{user:j}=p.useAuth(),{profile:v}=de(),m=j==null?void 0:j.id,[r,g]=c.useState({title:"",description:"",selectedDate:new Date,location:"",splitMethod:"equal",maxParticipants:""}),[M,D]=c.useState(!1),I=(s,a)=>{g(l=>({...l,[s]:a}))},{data:i,isLoading:z}=p.useQuery({hangouts:{$:{order:{serverCreatedAt:"desc"}},hangoutParticipants:{},hangoutExpenses:{}},hangoutParticipants:{$:{where:{userId:m}},hangouts:{hangoutParticipants:{},hangoutExpenses:{}}},profiles:{}}),u=c.useMemo(()=>((i==null?void 0:i.hangouts)??[]).map(a=>({...a,date:N(a.date),createdAt:N(a.createdAt),updatedAt:a.updatedAt?N(a.updatedAt):void 0,hangoutParticipants:Array.isArray(a.hangoutParticipants)?a.hangoutParticipants.map(l=>({...l,joinedAt:N(l.joinedAt),createdAt:N(l.createdAt)})):[],hangoutExpenses:Array.isArray(a.hangoutExpenses)?a.hangoutExpenses.map(l=>({...l,date:N(l.date),createdAt:N(l.createdAt),amount:Number(l.amount)||0})):[]})),[i==null?void 0:i.hangouts]),B=c.useMemo(()=>(i==null?void 0:i.profiles)??[],[i==null?void 0:i.profiles]),E=c.useMemo(()=>(i==null?void 0:i.hangoutParticipants)??[],[i==null?void 0:i.hangoutParticipants]),T=c.useMemo(()=>{var s;return((s=i==null?void 0:i.hangoutParticipants)==null?void 0:s.length)??0},[i==null?void 0:i.hangoutParticipants]),F=c.useMemo(()=>u.filter(s=>s.ownerId===m),[u,m]),O=c.useMemo(()=>u.filter(s=>s.isActive&&!s.isSettled),[u]),$=c.useMemo(()=>u.filter(s=>s.isSettled),[u]),n=()=>{g({title:"",description:"",selectedDate:new Date,location:"",splitMethod:"equal",maxParticipants:""})},b=c.useCallback(s=>u.find(a=>a.joinCode===s.trim().toUpperCase()),[u]),ne=async()=>{var s;if(!r.title.trim()){o.error("Please enter hangout title");return}D(!0);try{const a=q(),l=q(),C=Ie();await p.transact([p.tx.hangouts[a].update({ownerId:m,title:r.title.trim(),description:r.description.trim()||void 0,date:N(r.selectedDate),location:r.location.trim()||void 0,splitMethod:r.splitMethod,isActive:!0,isSettled:!1,joinCode:C,maxParticipants:r.maxParticipants?parseInt(r.maxParticipants):void 0,createdAt:new Date}),p.tx.hangoutParticipants[l].update({userId:m,hangoutId:a,displayName:((s=v==null?void 0:v.fullName)==null?void 0:s.split(" ")[0])||"Owner",joinedAt:new Date,sharePercentage:r.splitMethod==="percentage"?100:void 0,hasConfirmed:!0,hasPaid:!1,createdAt:new Date}).link({hangouts:a})]),o.success(`Share code: ${C}`),n(),S(!1)}catch(a){console.error("Create hangout error:",a),o.error("Failed to create hangout. Please try again.")}finally{D(!1)}},ie=async()=>{var s;if(!f.trim()){o.error("Please enter join code");return}D(!0);try{const a=b(f);if(!a){o.error("Hangout not found with this code");return}const{hangoutParticipants:l=[],maxParticipants:C}=a;if(l.some(J=>J.userId===m)){o.info("You're already part of this hangout");return}if(C&&l.length>=C){o.error("This hangout has reached maximum participants");return}await p.transact([p.tx.hangoutParticipants[q()].update({hangoutId:a.id,userId:m,displayName:((s=v==null?void 0:v.fullName)==null?void 0:s.split(" ")[0])||"User",joinedAt:new Date,hasConfirmed:!1,hasPaid:!1,createdAt:new Date}).link({hangouts:a.id})]),o.success(`Welcome to "${a.title}"`),w(""),H(!1)}catch(a){console.error("Join hangout error:",a),o.error("Failed to join hangout. Please try again.")}finally{D(!1)}},oe=async s=>{try{await navigator.clipboard.writeText(s),o.info("Join code copied to clipboard")}catch{o.error("Please copy the code manually")}},U=s=>!s||!Array.isArray(s.hangoutExpenses)?0:s.hangoutExpenses.reduce((a,l)=>a+((l==null?void 0:l.amount)||0),0);return{activeTab:t,setActiveTab:d,isCreateDialogOpen:h,setIsCreateDialogOpen:S,isJoinDialogOpen:x,setIsJoinDialogOpen:H,joinCode:f,setJoinCode:w,form:r,updateForm:I,isSubmitting:M,isLoading:z,userId:m,ownedHangouts:F,joinedHangouts:E,joinedHangoutParticipants:T,allProfiles:B,activeHangouts:O,settledHangouts:$,allHangouts:u,handleCreateHangout:ne,handleJoinHangout:ie,copyJoinCode:oe,calculateHangoutTotal:U,getParticipantOwes:(s,a)=>{var J;const l=U(s),C=((J=s==null?void 0:s.hangoutParticipants)==null?void 0:J.length)||1;switch(s==null?void 0:s.splitMethod){case"equal":return l/C;case"treat":return s.ownerId===a?l:0;default:return 0}},formatCurrency:Ee,handleAddExpense:async(s,a)=>{if(!a.description.trim()||!a.amount||a.amount<=0){o.error("Please fill all required fields");return}if(!m){o.error("User not authenticated");return}try{await p.transact([p.tx.hangoutExpenses[q()].update({hangoutId:s,paidById:m,description:a.description.trim(),amount:Number(a.amount),category:a.category||void 0,receiptUrl:a.receiptUrl||void 0,splitAmong:Array.isArray(a.splitAmong)?a.splitAmong:[],date:new Date,createdAt:new Date})]),o.success("Expense added")}catch(l){console.error("Add expense error:",l),o.error("Failed to add expense")}},handleDeleteExpense:async s=>{if(!s){o.error("Invalid expense ID");return}try{await p.transact([p.tx.hangoutExpenses[s].delete()]),o.success("Expense deleted")}catch(a){console.error("Delete expense error:",a),o.error("Failed to delete expense")}}}}export{Ue as C,Xe as H,Me as M,Ye as S,Ke as e,He as s,Ze as u};

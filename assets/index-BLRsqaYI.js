import{c as U,j as e,e as $,b as o}from"./theme-provider-Cr7NOLPU.js";import{c as d,B as i,Q as D,L as O,C as N,a as _,g as H,A as R,f as T,U as B,b as z,T as G,e as P,X as V,d as l}from"./App-DVLCLnW2.js";import{I as q}from"./input-CvXsPVmF.js";import{L as x}from"./label-BiwBe9Ab.js";import{v as J,e as Q,r as W,g as X}from"./index-DtNQoUsX.js";import{T as Y}from"./trash-2-2mc2yYUg.js";/**
 * @license lucide-react v0.532.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]],Z=d("camera",K);/**
 * @license lucide-react v0.532.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=[["path",{d:"M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4",key:"tonef"}],["path",{d:"M9 18c-4.51 2-5-2-7-2",key:"9comsn"}]],ae=d("github",ee);/**
 * @license lucide-react v0.532.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]],se=d("log-out",te);/**
 * @license lucide-react v0.532.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],le=d("pen",re);/**
 * @license lucide-react v0.532.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],ne=d("save",ie);function ce(){const t=U.c(3);let a;t[0]===Symbol.for("react.memo_cache_sentinel")?(a=e.jsx("div",{className:"text-muted-foreground flex flex-wrap items-center gap-2 text-sm",children:e.jsxs("span",{className:"text-muted-foreground ml-2 text-xs",children:["v",J]})}),t[0]=a):a=t[0];let n;t[1]===Symbol.for("react.memo_cache_sentinel")?(n=e.jsx(i,{variant:"ghost",size:"sm",asChild:!0,children:e.jsx("a",{href:`mailto:${Q}/?subject=${W}`,children:e.jsx(D,{size:16})})}),t[1]=n):n=t[1];let c;return t[2]===Symbol.for("react.memo_cache_sentinel")?(c=e.jsx("div",{className:"bg-background/95 supports-[backdrop-filter]:bg-background/60 border-t backdrop-blur",children:e.jsx("div",{className:"container mx-auto px-4 py-6",children:e.jsxs("div",{className:"flex flex-col items-center justify-between gap-4 sm:flex-row",children:[a,e.jsxs("div",{className:"flex items-center gap-4",children:[n,e.jsx(i,{variant:"ghost",size:"sm",asChild:!0,children:e.jsx("a",{href:X,target:"_blank",rel:"noopener noreferrer",children:e.jsx(ae,{size:16})})})]})]})})}),t[2]=c):c=t[2],c}function fe(){var k,w;const{user:t,profile:a,avatar:n,isLoading:c}=O(),g=$(),[v,h]=o.useState(!1),[f,m]=o.useState(!1),[p,j]=o.useState({firstName:"",lastName:"",fullName:""}),y=o.useRef(null);if(o.useEffect(()=>{a&&j({firstName:"",lastName:"",fullName:a.fullName||""})},[a]),c)return e.jsx("div",{className:"flex min-h-screen items-center justify-center",children:e.jsx("div",{className:"border-primary h-8 w-8 animate-spin rounded-full border-b-2"})});const S=async()=>{try{await l.auth.signOut(),g("/")}catch(s){throw console.error(s)}},b=async()=>{if(a!=null&&a.profilePicture)try{await l.storage.delete(a.profilePicture)}catch(s){console.error("Failed to delete old profile picture:",s)}},E=async s=>{if(t!=null&&t.id){m(!0);try{await b();const r=Date.now(),u=s.name.split(".").pop()||"jpg",C=`profiles/${t.id}/avatar_${r}.${u}`,L={contentType:s.type,contentDisposition:"inline"};await l.storage.uploadFile(C,s,L),await l.transact([l.tx.profiles[(a==null?void 0:a.id)||t.id].update({profilePicture:C,updatedAt:new Date().toISOString()})])}catch(r){console.error("Error uploading photo:",r)}finally{m(!1),g("/setting")}}},M=async()=>{if(!(!(t!=null&&t.id)||!(a!=null&&a.profilePicture))){m(!0);try{await b(),await l.transact([l.tx.profiles[a.id||t.id].update({profilePicture:"",updatedAt:new Date().toISOString()})])}catch(s){console.error("Error removing photo:",s)}finally{m(!1)}}},A=s=>{var u;const r=(u=s.target.files)==null?void 0:u[0];if(r){if(!r.type.startsWith("image/")){alert("Please select an image file.");return}if(r.size>5*1024*1024){alert("Please select an image smaller than 5MB.");return}E(r)}s.target.value=""},F=async()=>{if(t!=null&&t.id)try{const s={};p.fullName!==(a==null?void 0:a.fullName)&&(s.fullName=p.fullName),Object.keys(s).length>0&&(s.updatedAt=new Date().toISOString(),await l.transact([l.tx.profiles[(a==null?void 0:a.id)||t.id].update(s)])),h(!1)}catch(s){console.error("Error updating profile:",s)}},I=()=>{j({firstName:"",lastName:"",fullName:(a==null?void 0:a.fullName)||""}),h(!1)};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex items-center justify-between space-y-2 pt-6 pb-4",children:e.jsx("h1",{className:"my-1 text-3xl font-semibold tracking-tight",children:"Your Profile"})}),e.jsxs("div",{className:"mx-auto max-w-2xl space-y-6",children:[e.jsx(N,{children:e.jsxs(_,{className:"text-center",children:[e.jsxs("div",{className:"relative mx-auto",children:[e.jsxs(H,{className:"mx-auto h-24 w-24",children:[e.jsx(R,{src:n,alt:(a==null?void 0:a.fullName)||(t==null?void 0:t.email)||"User"}),e.jsx(T,{className:"text-lg",children:((k=a==null?void 0:a.fullName)==null?void 0:k.charAt(0))||((w=t==null?void 0:t.email)==null?void 0:w.charAt(0))||e.jsx(B,{size:24})})]}),e.jsx(i,{size:"sm",variant:"secondary",className:"absolute -right-2 -bottom-2 h-8 w-8 rounded-full p-0",onClick:()=>{var s;return(s=y.current)==null?void 0:s.click()},disabled:f,title:"Change profile picture",children:f?e.jsx("div",{className:"border-primary h-4 w-4 animate-spin rounded-full border-b-2"}):e.jsx(Z,{size:14})}),(a==null?void 0:a.profilePicture)&&!f&&e.jsx(i,{size:"sm",variant:"destructive",className:"absolute -bottom-2 -left-2 h-8 w-8 rounded-full p-0",onClick:M,title:"Remove profile picture",children:e.jsx(Y,{size:14})}),e.jsx("input",{ref:y,type:"file",accept:"image/*",onChange:A,className:"hidden"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(z,{className:"text-xl",children:(a==null?void 0:a.fullName)||"Unnamed User"}),e.jsx(G,{className:"text-sm",children:t==null?void 0:t.email})]}),e.jsx("p",{className:"text-muted-foreground mt-2 text-xs",children:"Click camera icon to upload • Max 5MB • JPG, PNG, GIF supported"})]})}),e.jsxs(N,{children:[e.jsxs(_,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(z,{className:"text-lg",children:"Profile Information"}),e.jsxs(i,{variant:"ghost",size:"sm",onClick:()=>h(!0),disabled:v,children:[e.jsx(le,{size:14,className:"mr-2"}),"Edit"]})]}),e.jsx(P,{className:"space-y-4",children:v?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(x,{htmlFor:"fullName",children:"Full Name"}),e.jsx(q,{id:"fullName",value:p.fullName,onChange:s=>j(r=>({...r,fullName:s.target.value})),placeholder:"Enter your full name"})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsxs(i,{onClick:F,size:"sm",children:[e.jsx(ne,{size:14,className:"mr-2"}),"Save Changes"]}),e.jsxs(i,{variant:"outline",onClick:I,size:"sm",children:[e.jsx(V,{size:14,className:"mr-2"}),"Cancel"]})]})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(x,{className:"text-muted-foreground text-sm font-medium",children:"Full Name"}),e.jsx("p",{className:"text-sm",children:(a==null?void 0:a.fullName)||"-"})]}),e.jsxs("div",{children:[e.jsx(x,{className:"text-muted-foreground text-sm font-medium",children:"Email"}),e.jsx("p",{className:"text-sm",children:t==null?void 0:t.email})]}),(a==null?void 0:a.updatedAt)&&e.jsxs("div",{children:[e.jsx(x,{className:"text-muted-foreground text-sm font-medium",children:"Last Updated"}),e.jsx("p",{className:"text-sm",children:new Date(a.updatedAt).toLocaleDateString()})]})]})})]}),e.jsx(N,{children:e.jsx(P,{className:"pt-6",children:e.jsxs(i,{onClick:S,variant:"destructive",size:"sm",className:"flex w-full items-center justify-center gap-2 hover:bg-red-500",children:[e.jsx(se,{size:14}),"Logout"]})})}),e.jsx(ce,{})]})]})}export{fe as default};
